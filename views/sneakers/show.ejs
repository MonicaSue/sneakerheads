<%- include('../partials/html-head') %>
<link rel="stylesheet" href="/stylesheets/sneakers/show.css">
<%- include('../partials/nav') %>

<main>
  <h1><%= title %></h1>
  <div class="button-section">
    <% if (sneaker.owner.equals(user?.profile._id)) { %>     
      <a href="/sneakers/<%= sneaker._id %>/edit">
        <button id="btn">Update</button>
      </a>
      <form action="/sneakers/<%= sneaker._id %>?_method=Delete" method="POST">
        <button type="submit" id="btn">Remove</button>
      </form>
    <% } %>
  </div>
  <div class="flex-container">
    <% if (sneaker.imageUrl) { %>
      <img src="<%= sneaker.imageUrl %>" alt="sneakers" width="auto" height="200px">
    <% } else {%>
      <img src="/assets/images/image-coming-soon.jpg" alt="image-coming-soon" width="200px" height="200px">
    <% } %>  
    <section class="sneaker-details">
      <h3><%= sneaker.nickname %></h3>
      <div><strong>Brand:</strong> <%= sneaker.brand %></div>
      <div><strong>Release Year:</strong> <%= sneaker.releaseYear %></div>
      <div><strong>SKU:</strong> <%= sneaker.sku %></div>
      <div><strong>Size:</strong> <%= sneaker.size %></div>
    <% if (sneaker.owner.equals(user?.profile._id)) { %>
      <div><strong>Purchase Price:</strong> $<%= sneaker.purchasePrice %></div>
      <div><strong>Ready to sell or trade?</strong>   <%= sneaker.isForSale ? 'Yes' : 'No' %></div>
    </section>
  </div>
  <section class="sneaker-sale-sheet">
      <% if (sneaker.saleSheets.length) { %>
        <table>
          <thead>
            <tr>
              <th>Condition</th>
              <th>Sale Price</th>
              <th>Delete</th>
            </tr>
          </thead>
          <tbody>
            <% sneaker.saleSheets.forEach(saleSheet => { %>
              <tr>
                <td><%= saleSheet.condition %></td>
                <td>$<%= saleSheet.salePrice %></td>
                <td>
                  <form 
                    action="/sneakers/<%= sneaker._id %>/saleSheets/<%= saleSheet._id %>?_method=DELETE"
                    method="POST"
                  >
                    <button type="submit" id="btn">X</button>
                  </form>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      <% } %>
      <% if (sneaker.isForSale && !sneaker.saleSheets.length) { %>
        <form 
          id="add-sellsheet-form"
          action="/sneakers/<%= sneaker._id %>/saleSheets"
          method="POST"
        >
        <label for="condition-input">Condition:</label>
        <select name="condition" id="condition-input">
          <option value="Grade A: Deadstock" selected>Grade A: Deadstock</option>
          <option value="Grade B: VND">Grade B: VND</option>
          <option value="Grade C: Lightly Used">Grade C: Lightly Used</option>
          <option value="Grade D: Worn">Grade D: Worn</option>
          <option value="Grade E: Beat">Grade E: Beat</option>
        </select>
        <label for="sale-price-input">Sale Price</label>
        <input type="text" name="salePrice" id="sale-price-input">
        <button type="submit" id="btn">Add Sale Sheet</button>
        </form>
      <% } %>
  </section>
  <% } %>  
  <% if (user) { %>
    <section class="comment-section">
      <h3>Comments</h3>
      <form 
        action="/sneakers/<%= sneaker._id %>/comments"
        method="POST"
        >
          <textarea name="content"></textarea><button>â†’</button>
      </form>
      <ul>
        <% sneaker.comments.forEach(comment => { %>
          <li>
            <h4><%= comment.author.name %></h4>
            <%= comment.content %>
            <% if (comment.author.equals(user?.profile)) { %>
              <form 
              action="/sneakers/<%= sneaker._id %>/comments/<%= comment._id %>?_method=DELETE" 
              method="POST"
              class="inline"
                >
                <button id="btn" type="submit">X</button>
              </form>
                <a href="/sneakers/<%= sneaker._id %>/comments/<%= comment._id %>/edit">
                  <button id="btn">Edit</button>
                </a>
            <% } %>
          </li>
        <% }) %>
      </ul>
    </section>
  <% } %>

</main>  

  <%- include('../partials/footer') %>